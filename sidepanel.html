<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>Easy Geminiv3.7</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      color-scheme: light dark;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
    }

    .wrap {
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 14px;
      width: min(860px, 96vw);
    }

    h1 {
      margin: 0;
      font-size: 16px;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    textarea {
      width: 100%;
      min-height: 100px;
      resize: vertical;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(128, 128, 128, .35);
      background: transparent;
    }

    select,
    button,
    input[type="number"],
    input[type="text"] {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(128, 128, 128, .35);
      background: transparent;
    }

    button.solid {
      background: #ffd54f;
      color: #1a1a1a;
      font-weight: 700;
    }

    button:disabled {
      opacity: .6;
      cursor: default;
    }

    .hint {
      font-size: 12px;
      color: gray;
    }

    .out {
      border: 1px solid rgba(128, 128, 128, .35);
      border-radius: 10px;
      padding: 10px 12px;
      white-space: pre-wrap;
      min-height: 120px;
      font-size: 1rem;
      line-height: 1.5;
    }

    .out.empty {
      color: gray;
    }

    .sep {
      height: 1px;
      background: rgba(128, 128, 128, .25);
    }

    /* â–¼ ã‚¿ãƒ–ã‚’ç¸¦ã«ç‹¬ç«‹ãƒœã‚¿ãƒ³ã§è¡¨ç¤º */
    .tabstack {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .tab {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      width: 100%;
      padding: 8px 12px;
      border: 1px solid rgba(128, 128, 128, .35);
      border-radius: 12px;
      background: transparent;
      cursor: pointer;
      text-align: left;
    }

    .tab.active {
      background: #ffd54f;
      color: #1a1a1a;
      border-color: #ffd54f;
    }

    .tab .x {
      border: 0;
      background: transparent;
      font-weight: 700;
      cursor: pointer;
    }

    .add-tab {
      width: 100%;
      padding: 8px 12px;
      border: 1px dashed rgba(128, 128, 128, .5);
      border-radius: 12px;
      background: transparent;
      cursor: pointer;
    }

    .tabwrap {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, .82);
      color: #fff;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 12px;
      z-index: 9999;
      display: none;
    }

    /* å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .history-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, .6);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
      overflow-y: auto;
    }

    .history-overlay.open {
      display: flex;
    }

    .history-modal {
      background: var(--bg, #1a1a1a);
      border-radius: 16px;
      width: min(700px, 95vw);
      max-height: 90vh;
      overflow-y: auto;
      padding: 20px;
    }

    @media (prefers-color-scheme: light) {
      .history-modal {
        --bg: #fff;
      }
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .history-header h2 {
      margin: 0;
      font-size: 18px;
    }

    .history-close {
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 4px 8px;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .history-item {
      border: 1px solid rgba(128, 128, 128, .35);
      border-radius: 12px;
      padding: 12px;
    }

    .history-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 12px;
      color: gray;
    }

    .history-item-model {
      font-weight: 700;
      color: #ffd54f;
    }

    .history-item-content {
      font-size: 13px;
      line-height: 1.5;
    }

    .history-item-tpl,
    .history-item-src,
    .history-item-out {
      margin-bottom: 8px;
      padding: 8px;
      background: rgba(128, 128, 128, .1);
      border-radius: 8px;
      white-space: pre-wrap;
      max-height: 150px;
      overflow-y: auto;
    }

    .history-item-label {
      font-size: 11px;
      font-weight: 700;
      color: gray;
      margin-bottom: 4px;
    }

    .history-item-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .history-item-actions button {
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 8px;
      border: 1px solid rgba(128, 128, 128, .35);
      background: transparent;
      cursor: pointer;
    }

    .history-item-actions button.reuse {
      background: #ffd54f;
      color: #1a1a1a;
      border-color: #ffd54f;
    }

    .history-item-actions button.delete {
      color: #f44336;
      border-color: #f44336;
    }

    .history-empty {
      text-align: center;
      color: gray;
      padding: 40px 0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="row" style="justify-content: space-between;">
      <h1>Easy Geminiv3.7 <small id="ver" class="hint"></small></h1>
      <div class="row">
        <button id="openHistory">ğŸ“š å±¥æ­´</button>
        <button id="openKey">è¨­å®š</button>
        <button id="openManager">ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†</button>
      </div>
    </header>

    <div id="needKey" class="hint" style="display:none;color:#d32f2f;font-weight:700;">
      ã¾ãšã€Œè¨­å®šã€ã‹ã‚‰ Gemini API ã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚
    </div>

    <!-- â–¼ ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ç¸¦ç©ã¿ã§è¡¨ç¤ºã€‚æ–°è¦ã¯å¸¸ã«ä¸‹ã«è¿½åŠ ã•ã‚Œã‚‹ -->
    <section class="tabwrap">
      <div id="tabbar" class="tabstack" role="tablist" aria-label="sessions"></div>
      <button id="addTab" class="add-tab">ï¼‹ æ–°è¦ã‚¿ãƒ–</button>
    </section>

    <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å†…å®¹ã¯ JS ã§ #pane ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° -->
    <div id="pane"></div>
  </div>

  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆè¤‡è£½ã—ã¦ä½¿ã†ï¼‰ -->
  <template id="tpl-session">
    <section class="session">
      <div class="row">
        <label class="row">Model
          <select data-k="model">
            <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
            <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
            <option value="gemini-3-pro-preview">Gemini 3 Pro</option>
            <option value="gemini-3-flash-preview">Gemini 3 Flash</option>
            <option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
            <option value="claude-sonnet-4">Claude Sonnet 4</option>
            <option value="claude-sonnet-4-5">Claude Sonnet 4.5</option>
            <option value="claude-haiku-4-5">Claude Haiku 4.5</option>
            <option value="claude-opus-4-5">Claude Opus 4.5</option>
            <option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
            <option value="gpt-5.2-chat-latest">GPT-5.2</option>
            <option value="gpt-5-chat-latest">GPT-5</option>
            <option value="gpt-5-mini">GPT-5 mini</option>
            <option value="gpt-4.1">GPT-4.1</option>
            <option value="gpt-4.1-mini">GPT-4.1 mini</option>
            <option value="gpt-4.1-nano">GPT-4.1 nano</option>
            <option value="gpt-4o">GPT-4o</option>
            <option value="gpt-4o-mini">GPT-4o mini</option>
            <option value="o3">o3</option>
            <option value="o3-mini">o3-mini</option>
            <option value="o4-mini">o4-mini</option>
          </select>
        </label>
        <span class="hint">âŒ˜/Ctrl + Enter ã§å®Ÿè¡Œ</span>
        <span style="flex:1;"></span>
        <label class="row hint">ã‚¿ã‚¤ãƒˆãƒ«
          <input data-k="title" type="text" placeholder="ã‚¿ãƒ–åï¼ˆè‡ªå‹•é€£ç•ªãƒ»æ‰‹å…¥åŠ›ã§ä¸Šæ›¸ãå¯ï¼‰" style="min-width:200px;">
        </label>
      </div>

      <section>
        <div><strong>æŒ‡ç¤ºï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰</strong> <span class="hint">ç®¡ç†ç”»é¢ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’æŒ¿å…¥å¯</span></div>
        <textarea data-k="tpl" placeholder="ä¾‹ï¼‰æ¬¡ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç·¨é›†è€…è¦–ç‚¹ã§æ¨æ•²ã€‚æ§‹æˆãƒ»èªå°¾ã‚’æ•´ãˆã€è¦‹å‡ºã—ã‚‚ææ¡ˆã€‚"></textarea>
      </section>

      <section>
        <div class="row" style="justify-content:space-between;">
          <div class="row">
            <label class="row">ãƒ—ãƒªã‚»ãƒƒãƒˆ
              <select data-k="presetSel" style="min-width:260px;"></select>
            </label>
            <button data-k="insertPreset">æŒ¿å…¥</button>
          </div>
          <div class="row">
            <button data-k="exportPresets">æ›¸ãå‡ºã—</button>
            <button data-k="importBtn">èª­ã¿è¾¼ã¿</button>
            <input data-k="importInput" class="hidden" type="file" accept="application/json" style="display:none;">
          </div>
        </div>
      </section>

      <section>
        <div class="row" style="justify-content:space-between; align-items:center;">
          <strong>é©ç”¨å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆï¼ˆç´ æï¼‰</strong>
          <button data-k="grabPage" title="ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã®æœ¬æ–‡ã‚’å–å¾—">ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ–ã®æœ¬æ–‡ã‚’å–å¾—</button>
        </div>
        <textarea data-k="src" placeholder="ã“ã“ã«ç´ æãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ï¼è²¼ã‚Šä»˜ã‘"></textarea>
      </section>

      <div class="sep"></div>

      <section class="row">
        <button data-k="gen" class="solid">Generate</button>
        <button data-k="cancel" style="display:none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button data-k="copy" title="å‡ºåŠ›ã‚’ã‚³ãƒ”ãƒ¼">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
        <span data-k="status" class="hint"></span>
      </section>

      <section>
        <div><strong>AIã®è¿”ç­”</strong></div>
        <div data-k="out" class="out empty">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
      </section>
    </section>
  </template>

  <div id="toast" class="toast"></div>

  <!-- å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="historyOverlay" class="history-overlay">
    <div class="history-modal">
      <div class="history-header">
        <h2>ğŸ“š å±¥æ­´</h2>
        <button id="historyClose" class="history-close">Ã—</button>
      </div>
      <div id="historyList" class="history-list"></div>
    </div>
  </div>

  <script src="sidepanel.js" defer></script>
</body>

</html>